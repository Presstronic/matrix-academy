# Development overrides for docker-compose.yml
# Usage: docker-compose -f docker-compose.yml -f docker-compose.dev.yml up

services:
  # Backend with hot reload
  backend:
    build:
      target: development
    container_name: matrix-academy-backend-dev
    environment:
      NODE_ENV: development
      LOG_LEVEL: debug
      DATABASE_URL: postgresql://matrix_user:dev_password@postgres:5432/matrix_academy
    volumes:
      # Mount source code for hot reload
      - ./apps/backend/src:/app/apps/backend/src:delegated
      - ./apps/backend/package.json:/app/apps/backend/package.json:ro
      - ./apps/backend/tsconfig.json:/app/apps/backend/tsconfig.json:ro
      - ./apps/backend/nest-cli.json:/app/apps/backend/nest-cli.json:ro
      - ./tsconfig.base.json:/app/tsconfig.base.json:ro
      # Prevent node_modules from being overwritten
      - /app/node_modules
      - /app/apps/backend/node_modules
    command: pnpm --filter @matrix-academy/backend dev

  # PostgreSQL with exposed logs for debugging
  postgres:
    container_name: matrix-academy-postgres-dev
    environment:
      POSTGRES_PASSWORD: dev_password
    command:
      - postgres
      - -c
      - log_statement=all
      - -c
      - log_connections=on
      - -c
      - log_disconnections=on

  # Redis with exposed logs
  redis:
    container_name: matrix-academy-redis-dev

  # Frontend (when ready)
  # frontend:
  #   build:
  #     target: development
  #   container_name: matrix-academy-frontend-dev
  #   volumes:
  #     - ./apps/frontend/src:/app/apps/frontend/src:delegated
  #     - /app/node_modules
  #     - /app/apps/frontend/node_modules
  #   environment:
  #     NODE_ENV: development
